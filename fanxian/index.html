<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>fanxian</title>
    <link rel="stylesheet" href="./index.css">
    <style>
        html,body{
            width: 100%;
            height: 100%;
        }
        .box{
            width: 100%;
            height: 500px;
            background-color: pink;
            margin:0 auto;
        }

    </style>
</head>
<body>

<div class="box" id="fx"></div>


</body>
</html>
<script>


    fanXian('fx');

    function fanXian(id) {
        var targetDom = document.getElementById(id),
                tDomH = targetDom.offsetHeight,
                domP = document.createElement("div"),
                domPheight = 0,
                dom = document.createElement("div"),
                data = '',
                dataLen = 0,
                i=0,
                html = "";
        domP.className = "listP";
        domP.appendChild(dom);
        targetDom.appendChild(domP);
        domPheight = domP.offsetHeight;

        domP.onscroll = function () {
            var domH = dom.offsetHeight;
            var sTop = domP.scrollTop;
            //console.log(domH);
            if(domH-domPheight-sTop<=0){
                getData();
            }
        };


        getData();
        //获取数据，并设置
        function getData() {
            var xhr = new XMLHttpRequest();
            var domCon = document.createElement("div");
            xhr.open("get","01.php");
            xhr.send(null);
            xhr.onreadystatechange = function () {
                if(xhr.status ==200 && xhr.readyState == 4){
                    //获取返回数据
                    data = JSON.parse(xhr.responseText);
                    dataLen = data.length;
                    //拼接html结构
                    for(;i<dataLen;i++){
                        html+='<div class=\"list\"><img src=\"'+ data[i].headImg+'\">';
                        html+='<div class=\"listRight\"><div class=\"listRightCon\"><div class=\"fxUser\">';
                        html+='<span>'+ data[i].name +'</span><span>'+ data[i].place +'</span></div>';
                        html+='<div class=\"fxMonTim\"><span>'+ data[i].money +'</span><span>'+ data[i].time +'</span></div>';
                        html+='</div></div></div>';
                    }
                    domCon.innerHTML = html;
                    dom.appendChild(domCon);

                }
            };

        }

    }


</script>